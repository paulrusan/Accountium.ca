function D(){const g=document.getElementById("embedding-canvas"),d=document.getElementById("embedding-viz-section");if(!g||!d)return;const e=g.getContext("2d");if(!e)return;const S={places:"#38bdf8",animals:"#34d399",emotions:"#fb7185",science:"#a78bfa"},I=[{word:"Paris",x:-120,y:-65,z:65,cluster:"places"},{word:"France",x:-170,y:-26,z:26,cluster:"places"},{word:"Tokyo",x:-65,y:-90,z:-65,cluster:"places"},{word:"Japan",x:-120,y:-52,z:-104,cluster:"places"},{word:"London",x:-145,y:-78,z:13,cluster:"places"},{word:"England",x:-195,y:-39,z:-26,cluster:"places"},{word:"dog",x:130,y:65,z:-39,cluster:"animals"},{word:"puppy",x:90,y:104,z:-13,cluster:"animals"},{word:"cat",x:170,y:78,z:39,cluster:"animals"},{word:"kitten",x:130,y:117,z:65,cluster:"animals"},{word:"bird",x:90,y:39,z:-65,cluster:"animals"},{word:"happy",x:-39,y:130,z:104,cluster:"emotions"},{word:"sad",x:13,y:156,z:65,cluster:"emotions"},{word:"angry",x:-13,y:117,z:143,cluster:"emotions"},{word:"love",x:-65,y:143,z:52,cluster:"emotions"},{word:"atom",x:143,y:-130,z:52,cluster:"science"},{word:"cell",x:104,y:-104,z:26,cluster:"science"},{word:"gene",x:130,y:-143,z:78,cluster:"science"},{word:"DNA",x:170,y:-117,z:104,cluster:"science"}],R=[{from:"France",to:"Paris",dashed:!1},{from:"Japan",to:"Tokyo",dashed:!0}];let u=0,f=null,x=0,w=0,k=0,L=0,p=!1,y=!1,v=0,b=0;const j=window.matchMedia("(prefers-reduced-motion: reduce)").matches?0:.003;function A(){const t=g.getBoundingClientRect(),o=window.devicePixelRatio||1;x=t.width,w=t.height,g.width=x*o,g.height=w*o,e.setTransform(o,0,0,o,0,0),k=x/2,L=w/2}function h(t,o,s){const n=Math.cos(u),a=Math.sin(u),c=t*n-s*a,l=t*a+s*n,i=500,r=i/(i+l);return{sx:c*r+k,sy:-o*r+L,scale:r,rz:l}}function q(){e.beginPath();const t=[-200,-100,0,100,200],o=250;for(const s of t){const n=h(-o,0,s),a=h(o,0,s);e.moveTo(n.sx,n.sy),e.lineTo(a.sx,a.sy)}for(const s of t){const n=h(s,0,-o),a=h(s,0,o);e.moveTo(n.sx,n.sy),e.lineTo(a.sx,a.sy)}e.strokeStyle="rgba(0, 50, 80, 0.08)",e.lineWidth=.5,e.stroke()}function C(t){const o=Object.keys(S);for(const s of o){const n=t.filter(c=>c.cluster===s),a=S[s];for(let c=0;c<n.length;c++)for(let l=c+1;l<n.length;l++){const i=n[c],r=n[l],M=(i.rz+r.rz)/2,P=Math.max(.03,Math.min(.12,.08-M*2e-4));e.beginPath(),e.moveTo(i.sx,i.sy),e.lineTo(r.sx,r.sy),e.strokeStyle=a,e.globalAlpha=P,e.lineWidth=.8,e.stroke()}}e.globalAlpha=1}function F(t){const o=l=>t.find(i=>i.word===l);for(const l of R){const i=o(l.from),r=o(l.to);if(!i||!r)continue;const M=(i.rz+r.rz)/2,P=Math.max(.25,Math.min(.75,.55-M*.001));e.save(),e.globalAlpha=P,e.strokeStyle="#00d4ff",e.lineWidth=2,l.dashed?e.setLineDash([6,4]):e.setLineDash([]),e.beginPath(),e.moveTo(i.sx,i.sy),e.lineTo(r.sx,r.sy),e.stroke(),e.setLineDash([]);const z=Math.atan2(r.sy-i.sy,r.sx-i.sx),T=8;e.beginPath(),e.moveTo(r.sx,r.sy),e.lineTo(r.sx-T*Math.cos(z-.35),r.sy-T*Math.sin(z-.35)),e.lineTo(r.sx-T*Math.cos(z+.35),r.sy-T*Math.sin(z+.35)),e.closePath(),e.fillStyle="#00d4ff",e.fill(),e.restore()}const s=o("France"),n=o("Japan"),a=o("Paris"),c=o("Tokyo");s&&n&&a&&c&&(e.save(),e.setLineDash([2,4]),e.strokeStyle="rgba(0, 50, 80, 0.15)",e.lineWidth=1,e.beginPath(),e.moveTo(s.sx,s.sy),e.lineTo(n.sx,n.sy),e.stroke(),e.beginPath(),e.moveTo(a.sx,a.sy),e.lineTo(c.sx,c.sy),e.stroke(),e.setLineDash([]),e.restore())}function X(t){const o=S[t.cluster]||"#38bdf8",s=7*t.scale,n=Math.max(.3,Math.min(1,.7-t.rz*.0015));e.save(),e.globalAlpha=n*.18,e.beginPath(),e.arc(t.sx,t.sy,s*2.5,0,Math.PI*2),e.fillStyle=o,e.fill(),e.globalAlpha=n*.9,e.beginPath(),e.arc(t.sx,t.sy,s,0,Math.PI*2),e.fillStyle=o,e.fill(),e.globalAlpha=n*.9;const a=Math.max(10,13*t.scale);e.font=`600 ${a}px Inter, system-ui, sans-serif`,e.textAlign="center",e.fillStyle="rgba(26, 46, 58, 0.9)",e.fillText(t.word,t.sx,t.sy-s-7),e.restore()}function E(){e.clearRect(0,0,x,w),q();const t=I.map(o=>{const s=h(o.x,o.y,o.z);return{...o,...s}});t.sort((o,s)=>s.rz-o.rz),C(t),F(t),t.forEach(o=>X(o)),y||(u+=j),p&&(f=requestAnimationFrame(E))}function W(){f||(p=!0,A(),E())}function B(){p=!1,f&&(cancelAnimationFrame(f),f=null)}g.addEventListener("mousedown",t=>{y=!0,v=t.clientX,b=u}),window.addEventListener("mousemove",t=>{y&&(u=b+(t.clientX-v)*.005)}),window.addEventListener("mouseup",()=>{y=!1}),g.addEventListener("touchstart",t=>{y=!0,v=t.touches[0].clientX,b=u},{passive:!0}),window.addEventListener("touchmove",t=>{y&&(u=b+(t.touches[0].clientX-v)*.005)},{passive:!0}),window.addEventListener("touchend",()=>{y=!1}),new IntersectionObserver(t=>{t.forEach(o=>{o.isIntersecting?W():B()})},{threshold:.1}).observe(d),window.addEventListener("resize",()=>{p&&A()});const m=window.gsap,J=window.ScrollTrigger;if(m&&J){const t=d.querySelector('[data-embed="text"]'),o=d.querySelector('[data-embed="canvas-wrap"]'),s=d.querySelector('[data-embed="legend"]'),n=d.querySelector('[data-embed="analogy"]');m.from(t,{opacity:0,y:20,duration:.6,scrollTrigger:{trigger:d,start:"top 80%",toggleActions:"play none none reverse"}}),m.from(o,{opacity:0,y:15,duration:.6,scrollTrigger:{trigger:d,start:"top 75%",toggleActions:"play none none reverse"}}),m.from(s,{opacity:0,duration:.4,scrollTrigger:{trigger:d,start:"top 70%",toggleActions:"play none none reverse"}}),m.from(n,{opacity:0,y:15,duration:.6,scrollTrigger:{trigger:d,start:"top 65%",toggleActions:"play none none reverse"}})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D();
