---
import BaseLayout from '../layouts/BaseLayout.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import { testimonials } from '../data/testimonials';
import { site } from '../data/site';


const features = [
  {
    num: '01',
    title: 'AI Accounting',
    sub: "World's first AI-powered accounting",
    desc: "Experience the future of Accounting Software with our revolutionary world's first artificial intelligence system. With the ability to control the system with simple commands from your email, managing your finances has never been easier.",
    href: '/features',
    color: 'var(--color-accent)',
    image: '/images/Ai-Accounting--wrldfirst.svg',
  },
  {
    num: '02',
    title: 'Streamline Sales',
    sub: 'Invoicing & online payments',
    desc: 'Send professional invoices to clients and start accepting online payments. Automatically record transactions in your books.',
    href: '/features',
    color: 'var(--color-green)',
    image: '/images/Streamline%20Sales.svg',
  },
  {
    num: '03',
    title: 'Smart Banking',
    sub: 'Bank feeds & transaction categorization',
    desc: 'Connect your bank to Accountium and set up bank feeds. Transactions flow securely straight into Accountium each business day. Monitor transactions and categorize them instantly.',
    href: '/features',
    color: 'var(--color-accent)',
    image: '/images/smart%20banking.svg',
  },
  {
    num: '04',
    title: 'Business On‑the‑go',
    sub: 'Access anywhere, on any device',
    desc: 'Keep an eye on your finances anywhere anytime on your mobile. Track bank balances, invoices, bills and more. Your data is synced across all devices all the time.',
    href: '/features',
    color: 'var(--color-accent)',
    image: '/images/Business%20On%E2%80%91the%E2%80%91go.svg',
  },
  {
    num: '05',
    title: 'Payroll',
    sub: 'CRA remittance · Paystubs · T4',
    desc: 'Our Payroll application is feature-rich and meets all of your payroll processing needs, while processing your payroll efficiently and accurately every time.',
    href: '/features',
    color: 'var(--color-green)',
    image: '/images/payroll%20pay.svg',
  },
];
---

<BaseLayout>

  <!-- ════════════════════════════════════════════════════════
       HERO
  ════════════════════════════════════════════════════════ -->
  <section class="hero" aria-label="Hero">
    <canvas id="particle-canvas" aria-hidden="true"></canvas>
    <div class="hero-inner">
      <p class="hero-eyebrow">ACCOUNTIUM</p>
      <h1 class="hero-headline">
        Numbers Made Easy<br />Business Run Brilliant
      </h1>

      <div class="hero-actions">
        <a href={site.appUrl} class="btn btn-ghost" target="_blank" rel="noopener noreferrer">
          TRY NOW
        </a>
      </div>
    </div>

    <div class="scroll-cue" aria-hidden="true">
      <svg width="16" height="20" viewBox="0 0 16 20" fill="none">
        <path d="M8 1v14M2 10l6 7 6-7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
  </section>

  <!-- ════════════════════════════════════════════════════════
       CHAPTER 01 — Why Accountium
  ════════════════════════════════════════════════════════ -->
  <div class="chapter-divider reveal">
    <div class="container">
      <div class="chapter-drip"></div>
      <div class="chapter-label-row">
        <span class="chapter-num">01</span>
        <span class="chapter-title">Why Accountium</span>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════════════════════════════════
       PILLARS
  ════════════════════════════════════════════════════════ -->
  <section class="b4s2" aria-labelledby="pillars-heading">
    <h2 id="pillars-heading">Numbers Simplified Decisions Amplified</h2>
    <p>Accountium leads the industry with an elegant design and functionality. Work more effectively by getting a complete, real-time view of your business's financial performance.</p>
  </section>

  <!-- ════════════════════════════════════════════════════════
       CHAPTER 02 — Features
  ════════════════════════════════════════════════════════ -->
  <div class="chapter-divider reveal">
    <div class="container">
      <div class="chapter-drip"></div>
      <div class="chapter-label-row">
        <span class="chapter-num">02</span>
        <span class="chapter-title">Features</span>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════════════════════════════════
       FEATURE SECTIONS (alternating)
  ════════════════════════════════════════════════════════ -->
  <section class="features-section" aria-label="Product features">
    <div class="container">
      {features.map((f, i) => (
        <div class:list={['feature-row reveal', { 'feature-row--flip': i % 2 !== 0 }]}>
          <!-- Text -->
          <div class="feature-text">
            <p class="feature-num" style={`color:${f.color}`}>{f.num}</p>
            <h2 class="feature-title">{f.title}</h2>
            <p class="feature-sub">{f.sub}</p>
            <p class="feature-desc">{f.desc}</p>
            <a href="https://www.myaccountium.ca/Account/SignIn" class="btn btn-ghost feature-cta" target="_blank" rel="noopener noreferrer">
              Try Now
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" aria-hidden="true">
                <path d="M2 7h10M8 3l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
          <!-- Visual placeholder -->
          <div class:list={['feature-visual', { 'feature-visual--particle': i === 0 }]} aria-hidden="true">
            {i === 0 && <canvas class="feature-particle-canvas"></canvas>}
            {f.image && <img src={f.image} alt="" style={`width:100%;height:auto;border-radius:8px;${i === 0 ? 'position:relative;z-index:1;' : ''}`} />}
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- ════════════════════════════════════════════════════════
       CHAPTER 03 — Testimonials
  ════════════════════════════════════════════════════════ -->
  <div class="chapter-divider reveal">
    <div class="container">
      <div class="chapter-drip"></div>
      <div class="chapter-label-row">
        <span class="chapter-num">03</span>
        <span class="chapter-title">What customers say</span>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════════════════════════════════
       TESTIMONIALS
  ════════════════════════════════════════════════════════ -->
  <section class="testimonials-section" aria-labelledby="testimonials-heading">
    <div class="container">
      <div class="section-header reveal">
        <h2 id="testimonials-heading">Your Accountant on Autopilot</h2>
      </div>
      <div class="testimonials-grid">
        {testimonials.map((t, i) => (
          <div class="reveal" style={`--delay:${i * 100}ms`}>
            <TestimonialCard {...t} />
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- ════════════════════════════════════════════════════════
       CHAPTER 04 — Get started
  ════════════════════════════════════════════════════════ -->
  <div class="chapter-divider reveal">
    <div class="container">
      <div class="chapter-drip"></div>
      <div class="chapter-label-row">
        <span class="chapter-num">04</span>
        <span class="chapter-title">Get started</span>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════════════════════════════════
       BOTTOM CTA
  ════════════════════════════════════════════════════════ -->
  <section class="bottom-cta reveal" aria-labelledby="cta-heading">
    <div class="cta-glow" aria-hidden="true"></div>
    <div class="container bottom-cta-inner">
      <h2 id="cta-heading">Online accounting software</h2>
      <p>
        Join thousands of Canadian businesses who trust Accountium
        to keep their books accurate and their finances clear.
      </p>
      <div class="cta-actions">
        <a href={site.appUrl} class="btn btn-primary" target="_blank" rel="noopener noreferrer">
          Try for free
        </a>
      </div>
    </div>
  </section>

</BaseLayout>

<!-- ─── Particle Canvas ─────────────────────────────────────── -->
<script>
(function () {
  const canvas = document.getElementById('particle-canvas') as HTMLCanvasElement;
  if (!canvas) return;
  const ctx = canvas.getContext('2d')!;
  const DOT_COLOR = '255, 0, 0';
  const LINE_COLOR = '0, 0, 255';
  const DIST  = 150;
  const N     = window.innerWidth < 768 ? 28 : 55;

  function resize() {
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize, { passive: true });

  type P = { x: number; y: number; vx: number; vy: number; r: number };
  const pts: P[] = Array.from({ length: N }, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    vx: (Math.random() - 0.5) * 0.38,
    vy: (Math.random() - 0.5) * 0.38,
    r: Math.random() * 1.4 + 0.5,
  }));

  let raf: number;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < pts.length; i++) {
      const p = pts[i];
      p.x += p.vx; p.y += p.vy;
      if (p.x < 0 || p.x > canvas.width)  p.vx *= -1;
      if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgb(${DOT_COLOR})`;
      ctx.fill();
      for (let j = i + 1; j < pts.length; j++) {
        const q = pts[j];
        const d = Math.hypot(p.x - q.x, p.y - q.y);
        if (d < DIST) {
          ctx.beginPath();
          ctx.moveTo(p.x, p.y);
          ctx.lineTo(q.x, q.y);
          ctx.strokeStyle = `rgba(${LINE_COLOR},${(1 - d / DIST) * 0.80})`;
          ctx.lineWidth = 0.8;
          ctx.stroke();
        }
      }
    }
    raf = requestAnimationFrame(draw);
  }
  const io = new IntersectionObserver(
    ([e]) => { e.isIntersecting ? draw() : cancelAnimationFrame(raf); },
    { threshold: 0 }
  );
  io.observe(canvas.closest('section')!);
})();
</script>

<!-- ─── Scroll Reveal ───────────────────────────────────────── -->
<script>
(function () {
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  const els = document.querySelectorAll<HTMLElement>('.reveal');
  els.forEach((el) => {
    const d = el.style.getPropertyValue('--delay') || '0ms';
    el.style.cssText += `opacity:0;transform:translateY(22px);transition:opacity .55s ease ${d},transform .55s ease ${d}`;
  });
  const io = new IntersectionObserver(
    (entries) => entries.forEach((e) => {
      if (!e.isIntersecting) return;
      const el = e.target as HTMLElement;
      el.style.opacity = '1';
      el.style.transform = 'none';
      io.unobserve(el);
    }),
    { threshold: 0.1 }
  );
  els.forEach((el) => io.observe(el));
})();
</script>

<style>
  /* ── b4s2: Chapter Divider (Iceberg style) ─────────────── */
  .b4s2 {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    gap: var(--space-6);
    padding: var(--space-12) var(--space-8);
    position: relative;
    background: radial-gradient(ellipse at 50% 80%, rgba(8, 145, 178, 0.06) 0%, transparent 50%);
  }

  .b4s2::before {
    content: "";
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: var(--space-16);
    background: linear-gradient(to bottom, transparent, var(--color-accent), transparent);
  }

  .b4s2 h2 {
    font-size: var(--text-2xl);
    font-weight: 700;
    letter-spacing: -0.03em;
    color: var(--color-text-primary);
    margin-bottom: var(--space-4);
  }

  .b4s2 p {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    line-height: 1.7;
    max-width: 58ch;
    margin: 0;
  }

  /* ── Hero ─────────────────────────────────────────────── */
  .hero {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background:
      radial-gradient(ellipse 80% 55% at 50% -10%, rgba(8, 145, 178, 0.08) 0%, transparent 65%),
      var(--color-bg);
  }

  #particle-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    opacity: 0.45;
  }

  .hero-inner {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-6);
    padding: calc(var(--header-height) + var(--space-12)) var(--space-6) var(--space-16);
    max-width: 820px;
    margin-inline: auto;
    animation: hero-in 1s var(--ease-out-expo) both;
  }

  @keyframes hero-in {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: none; }
  }

  .hero-eyebrow {
    font-size: 4rem;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: #1a2e3a;
    margin: 0;
    max-width: none;
  }

  .hero-headline {
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: -0.035em;
    line-height: 1.08;
    color: #1a2e3a;
  }

  .hero-sub {
    font-size: var(--text-lg);
    color: #1a2e3a;
    line-height: 1.7;
    max-width: 52ch;
    margin: 0;
  }

  .hero-actions {
    display: flex;
    gap: var(--space-4);
    flex-wrap: wrap;
    justify-content: center;
    margin-top: var(--space-2);
  }

  .scroll-cue {
    position: absolute;
    bottom: var(--space-8);
    left: 50%;
    transform: translateX(-50%);
    z-index: 1;
    color: var(--color-text-muted);
    animation: bounce-down 2.2s ease-in-out infinite;
  }

  @keyframes bounce-down {
    0%, 100% { opacity: 0.4; transform: translateX(-50%) translateY(0); }
    50%       { opacity: 0.8; transform: translateX(-50%) translateY(6px); }
  }

  /* ── Chapter Dividers (Iceberg vertical-drip style) ───── */
  .chapter-divider {
    padding-top: var(--space-24);
    padding-bottom: var(--space-8);
  }

  .chapter-divider .container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .chapter-drip {
    width: 1px;
    height: 56px;
    background: linear-gradient(to bottom, transparent, var(--color-accent));
    margin-bottom: var(--space-4);
  }

  .chapter-label-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-3);
  }

  .chapter-num {
    font-size: var(--text-xs);
    font-weight: 700;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--color-accent);
  }

  .chapter-title {
    font-size: var(--text-xs);
    font-weight: 500;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--color-text-muted);
  }

  /* ── Section Header ───────────────────────────────────── */
  .section-header {
    text-align: center;
    margin-inline: auto;
    margin-bottom: var(--space-12);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-4);
    max-width: 680px;
  }

  .section-header h2 {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.03em;
    line-height: 1.15;
  }


  /* ── Features ─────────────────────────────────────────── */
  .features-section {
    padding-bottom: var(--space-8);
    background: var(--color-bg);
  }

  .feature-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-16);
    align-items: center;
    padding-block: var(--space-16);
    border-bottom: 1px solid var(--color-border);
  }

  .feature-row:last-child { border-bottom: none; }

  .feature-row--flip .feature-text  { order: 2; }
  .feature-row--flip .feature-visual { order: 1; }

  .feature-text {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .feature-num {
    font-size: var(--text-xs);
    font-weight: 700;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    max-width: none;
    margin: 0;
  }

  .feature-title {
    font-size: var(--text-3xl);
    font-weight: 700;
    letter-spacing: -0.03em;
    line-height: 1.1;
  }

  .feature-sub {
    font-size: var(--text-sm);
    font-weight: 600;
    letter-spacing: 0.04em;
    color: var(--color-text-muted);
    text-transform: uppercase;
    max-width: none;
    margin: 0;
  }

  .feature-desc {
    font-size: var(--text-base);
    color: var(--color-text-secondary);
    line-height: 1.7;
    max-width: 48ch;
    margin: 0;
  }

  .feature-cta {
    align-self: flex-start;
    margin-top: var(--space-2);
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    transition: gap var(--duration-base) var(--ease-out-expo);
  }

  .feature-cta:hover { gap: var(--space-3); }

  .feature-visual {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Particle animation container for first feature visual */
  .feature-visual--particle {
    position: relative;
    overflow: hidden;
    border-radius: var(--radius-lg);
    min-height: 300px;
  }

  .feature-particle-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    display: block;
  }

  .feature-visual-inner {
    width: 100%;
    max-width: 360px;
    aspect-ratio: 4/3;
    border-radius: var(--radius-lg);
    padding: var(--space-8);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--space-6);
  }

  .visual-dot-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
  }

  .visual-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    opacity: 0.35;
  }

  .visual-dot:nth-child(odd)  { opacity: 0.65; }
  .visual-dot:nth-child(3n)   { opacity: 0.15; }

  .visual-label {
    font-size: var(--text-sm);
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    max-width: none;
    margin: 0;
  }

  /* ── Testimonials ─────────────────────────────────────── */
  .testimonials-section {
    padding-bottom: var(--space-12);
    background:
      radial-gradient(ellipse 60% 50% at 50% 50%, rgba(8, 145, 178, 0.05) 0%, transparent 70%),
      var(--color-bg-secondary);
    padding-top: var(--space-4);
  }

  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-6);
  }

  /* ── Bottom CTA ───────────────────────────────────────── */
  .bottom-cta {
    position: relative;
    overflow: hidden;
    padding-block: var(--space-24);
    text-align: center;
    background: var(--color-bg);
  }

  .cta-glow {
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 55% 80% at 30% 50%, rgba(8, 145, 178, 0.08) 0%, transparent 60%),
      radial-gradient(ellipse 40% 60% at 70% 50%, rgba(13, 148, 136, 0.06) 0%, transparent 60%);
    pointer-events: none;
  }

  .bottom-cta-inner {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-6);
  }

  .bottom-cta-inner h2 {
    font-size: var(--text-3xl);
    font-weight: 700;
    letter-spacing: -0.03em;
  }

  .bottom-cta-inner > p {
    max-width: 50ch;
    text-align: center;
    margin: 0;
  }

  .cta-actions {
    display: flex;
    gap: var(--space-4);
    flex-wrap: wrap;
    justify-content: center;
    margin-top: var(--space-2);
  }

  /* ── Responsive ───────────────────────────────────────── */
  @media (max-width: 900px) {
.testimonials-grid { grid-template-columns: 1fr; }
    .feature-row       { grid-template-columns: 1fr; gap: var(--space-8); }
    .feature-row--flip .feature-text  { order: 0; }
    .feature-row--flip .feature-visual { order: 0; }
    .feature-desc      { max-width: none; }
    .feature-visual-inner { max-width: 100%; }
  }

  @media (max-width: 768px) {
    /* Hero */
    .hero-eyebrow {
      font-size: 2rem;
    }
    .hero-headline {
      font-size: 1.5rem;
    }
    .hero-sub {
      font-size: var(--text-base);
    }
    /* Section header */
    .section-header h2 {
      font-size: 1.5rem;
    }
    /* Features */
    .feature-row {
      padding: 0 var(--space-4);
    }
    .feature-title {
      font-size: 1.5rem;
    }
    /* Bottom CTA */
    .bottom-cta-inner h2 {
      font-size: 1.75rem;
    }
  }

  @media (max-width: 600px) {
    /* Hero */
    .hero-eyebrow {
      font-size: 1.5rem;
      margin-bottom: var(--space-2);
    }
    .hero-headline {
      font-size: 1.25rem;
      line-height: 1.2;
    }
    /* Features */
    .feature-num {
      font-size: 3rem;
    }
    .feature-title {
      font-size: 1.25rem;
    }
    .feature-visual {
      margin-top: var(--space-4);
    }
    /* Testimonials */
    .testimonials-grid {
      grid-template-columns: 1fr;
    }
    /* Bottom CTA */
    .bottom-cta-inner h2 {
      font-size: 1.5rem;
    }
    .cta-actions { flex-direction: column; align-items: stretch; }
    .cta-actions .btn { justify-content: center; }
    .hero-actions { flex-direction: column; align-items: stretch; }
    .hero-actions .btn { justify-content: center; }
  }

</style>
